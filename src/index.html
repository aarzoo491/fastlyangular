<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>LongAngular</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script async type="text/javascript">
        window.visiopt_code = window.visiopt_code ||
            (function () {
              console.log("VISIOPT: Start Smartcode");
                var visi_wid = 1040;
                var visi_flicker_time = 4000;
                var visi_flicker_element = "html";
                var d = document;
                var c = false;
                var lastPath = location.pathname;
                var visi_fn = {
                    begin: function () {
                      console.log("VISIOPT: begin start");
                        if (d.getElementById("visi_flicker")) return;
                        var css = visi_flicker_element + "{opacity:0!important;background:none!important;}";
                        var st = d.createElement("style");
                        st.id = "visi_flicker";
                        st.type = "text/css";
                        if (st.styleSheet) st.styleSheet.cssText = css;
                        else st.appendChild(d.createTextNode(css));
                        d.head.appendChild(st);
                      console.log("VISIOPT: begin end");
                    },
                    complete: function () {
                        console.log("START visi_flicker Remove");
                        c = true;
                        var f = d.getElementById("visi_flicker");
                        if (f) f.remove();
                        console.log("END visi_flicker Remove");
                    },
                    completed: function () {
                        console.log("Process completed");
                        return c;
                    },
                    pack: function (src) {
                      console.log("VISIOPT: pack start");
                        waitForAppHome(function () {
                          console.log("VISIOPT: found app home and load js file");
                            if (window.__visi_vt_loaded__) {
                                runVisiForCurrentPage();
                                return;
                            }
                            window.__visi_vt_loaded__ = true;
                            var s = d.createElement("script");
                            s.src = src;
                            s.type = "text/javascript";
                            s.async = true;
                            s.onerror = function () {
                                visi_fn.complete();
                            };
                            d.head.appendChild(s);
                        });
                    },
                    init: function () {
                      console.log("VISIOPT: smartcode init");
                        visi_fn.begin();
                        setTimeout(function () {
                            console.log("4 sec logic");
                            visi_fn.complete();
                        }, visi_flicker_time);

                        visi_fn.pack("https://visiopt.com/tracking/vt." + visi_wid + "_2 1.js?v=dddd");
                        return true;
                    }
                };
                window.visiopt_code_status = visi_fn.init();
                function waitForAppHome(done) {
                    let tries = 0;
                    function check() {
                      console.log("try to find app-root");
                        tries++;
                        if (document.querySelector("app-root")) {
                            requestAnimationFrame(() => {
                                requestAnimationFrame(() => {
                                    done();
                                });
                            });
                            return;
                        }
                        if (tries < 200) {
                            return setTimeout(check, 20);
                        }
                        done();
                    }
                    check();
                }
                function watchUrlChanges(callback) {
                    setInterval(function () {
                        var current = location.pathname;
                        if (current !== lastPath) {
                            lastPath = current;
                            console.log("[VISI] Route changed â†’", current);
                            callback();
                        }
                    }, 60);
                }
                function runVisiForCurrentPage() {
                    if (typeof VisiPageMatcher === "undefined") {
                        console.warn("VisiPageMatcher not loaded yet");
                        return;
                    }
                    var pageJson = VisiPageMatcher.getPageIdByURL(visiopt_settings.pages, location.href);
                    if (!pageJson) {
                        console.log("Page json not found");
                        return;
                    }
                    VisioptConfig.set(pageJson);
                    if (typeof resetVisioptBeforeRouteChange !== "undefined") {
                        if (!window.__visi_resetter__) {
                            window.__visi_resetter__ = new resetVisioptBeforeRouteChange();
                        }
                        window.__visi_resetter__.init();
                    }
                    if (typeof VisiOptSDK === "undefined") {
                        console.warn("VisiOptSDK missing");
                        return;
                    }
                    // waitForAppHome(function () {
                    //     window.VisiBoot();
                    // });
                    window.VisiBoot();
                }
                watchUrlChanges(function () {
                    runVisiForCurrentPage();
                });
                return visi_fn;
            })();
    </script>
</head>
<body>
  <app-root></app-root>
</body>
</html>
